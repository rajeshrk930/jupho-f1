generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  name          String?
  plan          Plan      @default(FREE)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  analyses      Analysis[]
  payments      Payment[]
}

model Analysis {
  id              String        @id @default(uuid())
  userId          String
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Creative details
  creativeUrl     String?
  creativeType    CreativeType
  primaryText     String?
  headline        String?
  objective       Objective
  problemFaced    ProblemFaced
  whatChanged     WhatChanged
  audienceType    AudienceType
  
  // Metrics (now required)
  cpm             Float
  ctr             Float
  cpa             Float
  
  // Analysis result
  primaryReason   String
  supportingLogic String[]
  singleFix       String
  
  // Pattern tagging (for future use)
  failureReason   String?
  resultType      ResultType    @default(AVERAGE)
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([userId])
  @@index([objective])
  @@index([problemFaced])
  @@index([resultType])
}

model Payment {
  id              String        @id @default(uuid())
  userId          String
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  razorpayOrderId String        @unique
  razorpayPaymentId String?
  amount          Int
  currency        String        @default("INR")
  status          PaymentStatus @default(PENDING)
  plan            Plan
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([userId])
}

enum Plan {
  FREE
  PRO
  AGENCY
}

enum CreativeType {
  IMAGE
  VIDEO
}

enum Objective {
  LEADS
  WHATSAPP
  SALES
}

enum ProblemFaced {
  LOW_CLICKS
  CLICKS_NO_ACTION
  MESSAGES_NO_CONVERSION
}

enum WhatChanged {
  CREATIVE_CHANGED
  AUDIENCE_CHANGED
  BUDGET_CHANGED
  NOTHING_NEW_AD
}

enum AudienceType {
  BROAD
  INTEREST_BASED
  LOOKALIKE
}

enum ResultType {
  DEAD
  AVERAGE
  WINNING
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
}
